# 检查预发布版本更新 - 使用 pre-release 标签
      - name: 检查预发布更新
        id: check_pre_release
        continue-on-error: true
        run: |
          # 获取所有发布信息
          RESPONSE=$(curl -s \
            -H "Accept: application/vnd.github.v3+json" \
            "https://api.github.com/repos/sealdice/sealdice-build/releases")
          
          echo "=== 预发布版本检查 ==="
          
          # 查找tag_name为"pre-release"的版本
          PRE_RELEASE=$(echo "$RESPONSE" | jq '[.[] | select(.tag_name == "pre-release")] | sort_by(.published_at) | last')
          
          echo "pre-release标签版本："
          echo "$PRE_RELEASE" | jq '{tag_name, name, published_at, assets_count: .assets | length}'
          
          # 检查是否找到pre-release版本
          if [ "$(echo "$PRE_RELEASE" | jq -r 'if . == null then "null" else "found" end')" == "found" ]; then
            # 从assets中查找linux_amd64文件
            LINUX_ASSET=$(echo "$PRE_RELEASE" | jq -r '.assets[] | select(.name | contains("linux_amd64")) | .name' | head -1)
            
            if [ -n "$LINUX_ASSET" ] && [ "$LINUX_ASSET" != "null" ]; then
              echo "找到Linux文件: $LINUX_ASSET"
              
              # 解析commit哈希（从文件名中提取）
              # 文件名格式：sealdice_20251201-5f26dde_linux_amd64.tar.gz
              COMMIT_HASH=$(echo "$LINUX_ASSET" | grep -oE '[0-9a-f]{7}' | head -1)
              TIMESTAMP=$(echo "$LINUX_ASSET" | grep -oE '2[0-9]{7}')
              
              echo "解析出的commit: $COMMIT_HASH"
              echo "解析出的时间戳: $TIMESTAMP"
              
              # 收集下载URL
              LINUX_AMD64_URL=$(echo "$PRE_RELEASE" | jq -r '.assets[] | select(.name | contains("linux_amd64.tar.gz")) | .browser_download_url')
              LINUX_ARM64_URL=$(echo "$PRE_RELEASE" | jq -r '.assets[] | select(.name | contains("linux_arm64.tar.gz")) | .browser_download_url')
              
              echo "下载URL:"
              echo "AMD64: $LINUX_AMD64_URL"
              echo "ARM64: $LINUX_ARM64_URL"
              
              # 创建预发布JSON
              cat > pre_release_temp.json << EOF
{
  "type": "pre-release",
  "date": "$TIMESTAMP",
  "commit_hash": "$COMMIT_HASH",
  "downloads": {
    "linux_amd64": "$LINUX_AMD64_URL",
    "linux_arm64": "$LINUX_ARM64_URL"
  }
}
EOF
              
              # 检查是否需要更新
              if [ -z "${{ env.PREV_PRE_COMMIT }}" ] || [ "${{ env.PREV_PRE_COMMIT }}" != "$COMMIT_HASH" ]; then
                echo "发现新版预发布，commit哈希: $COMMIT_HASH (之前: ${{ env.PREV_PRE_COMMIT }})"
                echo "PRE_NEED_UPDATE=true" >> $GITHUB_ENV
                mv pre_release_temp.json pre_release.json
              else
                echo "预发布版本未变化 (当前: $COMMIT_HASH, 之前: ${{ env.PREV_PRE_COMMIT }})"
                rm pre_release_temp.json
              fi
            else
              echo "未找到Linux版本文件"
            fi
          else
            echo "未找到pre-release标签的版本"
          fi
